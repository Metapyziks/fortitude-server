<?
	if (session == null) {
		response.Redirect("/login.html");
		return;
	}

	Include("parts/functions.html");
	getPageStart("Caches", null, null);
	Include("parts/header.html");
	Include ("parts/sidebar.html"); 

?>
		<div id = "content">
			<h1>View All Caches</h1>
			<p>
				Here is a list of every cache you own.
			</p>
			<ul class = "news">
<?
		foreach (var cache in caches) {
?>
			<li>
				<h1>{$cache.Name}</h1>
							
				<img src="http://maps.googleapis.com/maps/api/staticmap?center={$cache.Latitude},{$cache.Longitude}&markers={$cache.Latitude},{$cache.Longitude}&zoom=15&size=200x200&sensor=false" class="map_cache">
				
				<p>
					{$cache.Balance} soldiers | <a href="#">View on Main Map</a>
				</p>
			
<?
			var events = DatabaseManager.Select<Event>(x => x.Type >= EventType.Cache && x.ContextID == cache.CacheID);
			foreach (var evt in events)
			{
				switch(evt.Type)
				{
					case EventType.CachePlaced:
?>
				{$evt.TimeStamp.ToShortDateString()}
<?
						break;
					case EventType.CacheAttacked:
						var theBattleReportThing = DatabaseManager.SelectFirst<BattleReport>(x => x.NotificationID == evt.AuxiliaryID);
						if (theBattleReportThing == null) {
							break;
						}
						break;
				}
			}
?>
			</li>
<?
	}	
?>
			</ul>
		</div> <!-- content -->

		<? Include ("parts/footer.html"); ?>
