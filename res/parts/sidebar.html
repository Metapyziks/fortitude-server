<div id = "sidebar">
			<ul>
<? 	if (isSignedIn()) { ?>
				<li class = "sidebar_section">
					<h1>{$account.Username}</h1>
					<img src="/images/avatars/{$account.AvatarID}-normal.gif" class="avatar" />
					<br />
					<span>
						Elite warlord
					</span>
<? 		if (player != null && caches != null) { ?>
					<p>	
						{$caches.Sum(x => x.Balance) + player.Balance} {$pluralify("soldier", "soldiers", caches.Sum(x => x.Balance) + player.Balance)}<br />
						{$caches.Count} {$pluralify("cache", "caches", caches.Count)}
					</p>
<? 	
		} 
	
		else {
?>
					<p>	
						No soldiers<br />
						No caches
					</p>
<? 		} ?>
					<div style="clear: both;"></div>
				</li> <!-- username (account summary) -->
<? 	} ?>
				<li class = "sidebar_section">
					<h1>Search</h1>
					<center>
					<form>
						<input type="text"></input>
						<button>Search</button>
						<div style="clear: both;"></div>
					</form>
					</center>
				</li> <!-- search -->
<?	// If the user is not logged in, display the log in and sign up modules.
	if (!isSignedIn()) { ?>
				<li class = "sidebar_section">
					<? Include ("parts/login_module.html"); ?>
				</li>
				<li class = "sidebar_section">
					<? Include ("parts/signup_module.html"); ?>
				</li>
<?	} 

	// If the user is logged in and verified...
	if (isVerified()) {
?>
				<li class = "sidebar_section">
					<h1>Caches</h1>
					<ul>
<?
		// Loop through the first 5 caches and display their info
		int count = 0;
		foreach (var cache in caches) {
?>
						<li>
							<span>{$cache.Name}</span>
							<p>
								{$cache.Balance} soldiers | <a href="#">History</a> | <a href="#">View on Map</a>
							</p>
						</li>
<?
			count = count + 1;
			if (count == 5) break;
		}
?>
						<li class = "last_child">

<?
		if (count == 0) {
?>
							<p>
								You don't have any caches! Use the Fortitude App to place some caches.
							</p>
<?		
		}

		else {
?>
							<p>
								Showing {$count} most active {$pluralify("cache", "caches", count)}.
							</p>
							<p>
								<a href="#">View all caches</a>
							</p>
<?		}
?>
						</li>
					</ul>
				</li> <!-- caches -->
				<li class = "sidebar_section">
					<h1>Recent News</h1>
					<ul>
<?
		var news = DatabaseManager.Select<Notification>(x => x.AccountID == account.AccountID);
		int news_count = 0;
		foreach (var item in news) {
			if (item.Type == NotificationType.BattleReport) {
				var report = DatabaseManager.SelectFirst<BattleReport>(x => x.NotificationID == item.NotificationID);
				var cache = DatabaseManager.SelectFirst<Cache>(x => x.CacheID == report.CacheID);
				if (cache != null && report != null) {
?>
						<li>
							<span>{$cache.Name} has been {$(report.DefenderSurvivors > 0) ? "attacked" : "defeated"}</span>
							<p>
								Attackers : {$report.AttackerInitial} <br />
								Defenders : {$report.DefenderInitial} <br />
								Time: {$item.TimeStamp}!
							</p>
						</li>
<?
					news_count = news_count + 1;
					if (news_count == 5) break;

				}
			}
		}
?>
					<li class = "last_child">

<?
		if (news_count == 0) {
?>
							<p>
								You don't have any news! Start playing the game through the Fortitude app today.
							</p>
<?		
		}

		else {
?>
							<p>
								Showing {$news_count} most active {$pluralify("news item", "news items", news_count)}.
							</p>
							<p>
								<a href="#">View all caches</a>
							</p>
<?		}
?>
						</li>
					</ul>
				</li> <!-- recent news -->
<?
	}
?>
			</ul>	
		</div> <!-- sidebar -->