<!DOCTYPE html>

<?
    bool sent = false;
    bool received = false;
    string email = null;
    ErrorResponse error = null;
    EmailValidationCode valid = null;
    if (post["email"] != null)
    {
        sent = true;
        email = post["email"] ?? "";
        error = EmailValidationCode.AttemptCreate(
            EmailValidationType.ResetPassword, email, out valid);
    } else if (get["email"] != null && get["code"] != null) {
        received = true;
        email = get["email"] ?? "";
        var code = get["code"] ?? "";
        error = EmailValidationCode.AttemptGet(
            EmailValidationType.ResetPassword, email, code, out valid);
    }
?>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8" />
        <title>Fortitude Server Prototype - Reset Password</title>
    </head>
    <body>
        <center>
            <h1>Reset Password</h1>
<? if (!sent && !received) { ?>
            <form name="resetForm" action="/resetpassword.html" method="post" >
                <table>
                <tr><td>Email:   </td> <td><input type="email" name="email"/></td></tr>
                <tr><td colspan ="2">
                </td></tr>
                
                <tr><td colspan="2"><input type="submit" value="Send Password Reset Email" /></td></tr>
                </table>
            </form>
<? } else if (sent) { if (error != null) { ?>
            Could not send password reset email :(<br />
            Reason: {$error.Message}
<? } else { ?>
            <h2>Password Reset Email Sent!</h2>
            A password reset email has been sent to {$email}.<br />
            Click the link in the email to complete the password reset process.
<? } } else { if (error != null) { ?>
            Could not reset password :(<br />
            Reason: {$error.Message}
<? } else { ?>
            <form name="resetForm" action="/resetpassword.html" method="post" >
                <table>
                <tr><td>New Password:</td> <td><input type="password" name="pword"/></td></tr>
                <tr><td colspan ="2">
                </td></tr>
                
                <tr><td colspan="2"><input type="submit" value="Set Password" /></td></tr>
                </table>
            </form>
<? } } ?>
            <br />
            <br />
            <a href="/index.html">Home</a>
        </center>
    </body>
</html>
